schema: '2.0'
stages:
  data_processing:
    cmd: python -m src.data.make_dataset OUTPUT_TARGET_FILEPATH=.
    deps:
    - path: data/interim/data_for_train.pkl
      md5: c23161227647f65da1979b74e7c4e0c9
      size: 52256
    - path: data/interim/test.pkl
      md5: 77e53843e5690f8bd7b30b521f8a0574
      size: 37012
    - path: data/processed/target_for_data_for_train.pkl
      md5: bed81f076218178c4408936f2f8fa788
      size: 21106
    - path: data/raw/test.csv
      md5: a34d239835317e59b1b9f2fec27fa427
      size: 249580
    - path: data/raw/train.csv
      md5: 88f8b56af68bf8c7cf3fda9ae4ff02a8
      size: 400268
    - path: src/config.py
      md5: 3e4a7be725268dffcddc10290c19e4b1
      size: 2342
    - path: src/data/make_dataset.py
      md5: 9ba9d506d42669d4447ac591e6cc0a00
      size: 1568
    - path: src/data/preprocess.py
      md5: ccc727096623e37c6242cd9564edb4b2
      size: 4248
    - path: src/utils.py
      md5: a63e9fc88f67423ded9b88dcd49a34f6
      size: 387
    params:
      params.yaml:
        data_load:
          train_csv: data/raw/train.csv
          test_csv: data/raw/test.csv
        interim_paths:
          data_for_train_pkl: data/interim/data_for_train.pkl
          test_pkl: data/interim/test.pkl
        preprocess_category:
          TARGET_COLS:
          - Артериальная гипертензия
          - ОНМК
          - Стенокардия, ИБС, инфаркт миокарда
          - Сердечная недостаточность
          - Прочие заболевания сердца
          ID_COL: ID
          EDU_COL: Образование
          SEX_COL: Пол
          CAT_COLS:
          - Пол
          - Семья
          - Этнос
          - Национальность
          - Религия
          - Образование
          - Профессия
          - Статус Курения
          - Частота пасс кур
          - Алкоголь
          - Время засыпания
          - Время пробуждения
          OHE_COLS:
          - Пол
          - Вы работаете?
          - Выход на пенсию
          - Прекращение работы по болезни
          - Сахарный диабет
          - Гепатит
          - Онкология
          - Хроническое заболевание легких
          - Бронжиальная астма
          - 'Туберкулез легких '
          - ВИЧ/СПИД
          - Регулярный прим лекарственных средств
          - Травмы за год
          - Переломы
          - Пассивное курение
          - Сон после обеда
          - Спорт, клубы
          - Религия, клубы
          REAL_COLS:
          - Возраст курения
          - Сигарет в день
          - Возраст алког
        processed_paths:
          target_data_train_pkl: data/processed/target_for_data_for_train.pkl
          processed_test_pkl: data/processed/test.pkl
          processed_data_for_train_pkl: data/processed/data_for_train.pkl
  feature_generation:
    cmd: python -m src.features.build_features
    deps:
    - path: data/interim/data_for_train.pkl
      md5: c23161227647f65da1979b74e7c4e0c9
      size: 52256
    - path: data/interim/test.pkl
      md5: 77e53843e5690f8bd7b30b521f8a0574
      size: 37012
    - path: data/processed/data_for_train.pkl
      md5: 93ca7bd4408b0218310485335e50cbae
      size: 51584
    - path: data/processed/test.pkl
      md5: e5c0e58481efe3b0e4cfd9fa5934b074
      size: 36306
    - path: src/config.py
      md5: 3e4a7be725268dffcddc10290c19e4b1
      size: 2342
    - path: src/features/build_features.py
      md5: 67796ee742ff4e696533b2b56de2fa8c
      size: 404
    - path: src/features/functions.py
      md5: 351049ef04636f62f4ef08ae08f6ff96
      size: 2320
    - path: src/utils.py
      md5: a63e9fc88f67423ded9b88dcd49a34f6
      size: 387
    params:
      params.yaml:
        interim_paths:
          data_for_train_pkl: data/interim/data_for_train.pkl
          test_pkl: data/interim/test.pkl
        processed_paths:
          target_data_train_pkl: data/processed/target_for_data_for_train.pkl
          processed_test_pkl: data/processed/test.pkl
          processed_data_for_train_pkl: data/processed/data_for_train.pkl
  train:
    cmd: python -m src.models.train_model
    deps:
    - path: data/processed/X_test_data.pkl
      md5: ddf54f85d77d7028579f1d894be0fbd3
      size: 12877
    - path: data/processed/Y_test_data.pkl
      md5: e2ab0a773f00e8f17743bcbd99709014
      size: 1877
    - path: data/processed/data_for_train.pkl
      md5: 93ca7bd4408b0218310485335e50cbae
      size: 51584
    - path: data/processed/test.pkl
      md5: e5c0e58481efe3b0e4cfd9fa5934b074
      size: 36306
    - path: models/model_catboost.joblib
      md5: 2cdf4e085da9f9964f5b07a39b66ee24
      size: 4905042
    - path: models/model_lgbm.joblib
      md5: 2e7757e3d16fe2b452d0d49756021f83
      size: 6102739
    - path: src/config.py
      md5: 3e4a7be725268dffcddc10290c19e4b1
      size: 2342
    - path: src/models/functions.py
      md5: 8a4b4f02f391ac7f3fbcee3d992cd5d3
      size: 4778
    - path: src/models/train_model.py
      md5: 14cbed9bad7647f931b51c5554b01cd5
      size: 2186
    params:
      params.yaml:
        processed_paths:
          target_data_train_pkl: data/processed/target_for_data_for_train.pkl
          processed_test_pkl: data/processed/test.pkl
          processed_data_for_train_pkl: data/processed/data_for_train.pkl
        train:
          COL:
          - Пол
          - Семья
          - Этнос
          - Национальность
          - Религия
          - Профессия
          - Вы работаете?
          - Выход на пенсию
          - Прекращение работы по болезни
          - Сахарный диабет
          - Гепатит
          - Онкология
          - Хроническое заболевание легких
          - Бронжиальная астма
          - 'Туберкулез легких '
          - ВИЧ/СПИД
          - Регулярный прим лекарственных средств
          - Травмы за год
          - Переломы
          - Статус Курения
          - Пассивное курение
          - Частота пасс кур
          - Алкоголь
          - Сова/Жаворонок/Голубь
          - Часов сна
          - Сон после обеда
          - Спорт, клубы
          - Религия, клубы
          - Образование_ord
          - Возраст курения
          - Сигарет в день
          - Возраст алког
          CATEGORIES_COL_AFTER_PREP:
          - Пол
          - Семья
          - Этнос
          - Национальность
          - Религия
          - Профессия
          - Статус Курения
          - Частота пасс кур
          - Алкоголь
          - Сова/Жаворонок/Голубь
          test_size: 0.2
          iterations: 1000
          loss_function: MultiLogloss
          eval_metric: MultiLogloss
          learning_rate: 0.01
          bootstrap_type: Bayesian
          boost_from_average: false
          ctr_leaf_count_limit: 3
          leaf_estimation_iterations: 1
          leaf_estimation_method: Gradient
          model_catboost_path: models/model_catboost.joblib
          model_lgbm_path: models/model_lgbm.joblib
          X_test_path: data/processed/X_test_data.pkl
          Y_test_path: data/processed/Y_test_data.pkl
    outs:
    - path: catboost_info/learn_error.tsv
      md5: 38d78b72f1de2f4bbe5dfa1932c514d9
      size: 16806
  evaluate:
    cmd: python -m src.models.predict_model
    deps:
    - path: data/processed/X_test_data.pkl
      md5: ddf54f85d77d7028579f1d894be0fbd3
      size: 12877
    - path: data/processed/Y_test_data.pkl
      md5: e2ab0a773f00e8f17743bcbd99709014
      size: 1877
    - path: models/model_catboost.joblib
      md5: 2cdf4e085da9f9964f5b07a39b66ee24
      size: 4905042
    - path: models/model_lgbm.joblib
      md5: 2e7757e3d16fe2b452d0d49756021f83
      size: 6102739
    - path: src/config.py
      md5: 3e4a7be725268dffcddc10290c19e4b1
      size: 2342
    - path: src/models/functions.py
      md5: 8a4b4f02f391ac7f3fbcee3d992cd5d3
      size: 4778
    - path: src/models/predict_model.py
      md5: 42d0d6197eaff9111af5324b64e7b897
      size: 880
    - path: src/models/train_model.py
      md5: 14cbed9bad7647f931b51c5554b01cd5
      size: 2186
    params:
      params.yaml:
        evaluate:
          score_metric: f1
          score_path_catboost: reports/metrics_catboost.json
          score_path_lightgbm: reports/metrics_lightgbm.json
          score_path_rocauc_samples_catboost: reports/metrics_rocauc_catboost.csv
          score_path_rocauc_samples_lgbm: reports/metrics_rocauc_lgbm.csv
        train:
          COL:
          - Пол
          - Семья
          - Этнос
          - Национальность
          - Религия
          - Профессия
          - Вы работаете?
          - Выход на пенсию
          - Прекращение работы по болезни
          - Сахарный диабет
          - Гепатит
          - Онкология
          - Хроническое заболевание легких
          - Бронжиальная астма
          - 'Туберкулез легких '
          - ВИЧ/СПИД
          - Регулярный прим лекарственных средств
          - Травмы за год
          - Переломы
          - Статус Курения
          - Пассивное курение
          - Частота пасс кур
          - Алкоголь
          - Сова/Жаворонок/Голубь
          - Часов сна
          - Сон после обеда
          - Спорт, клубы
          - Религия, клубы
          - Образование_ord
          - Возраст курения
          - Сигарет в день
          - Возраст алког
          CATEGORIES_COL_AFTER_PREP:
          - Пол
          - Семья
          - Этнос
          - Национальность
          - Религия
          - Профессия
          - Статус Курения
          - Частота пасс кур
          - Алкоголь
          - Сова/Жаворонок/Голубь
          test_size: 0.2
          iterations: 1000
          loss_function: MultiLogloss
          eval_metric: MultiLogloss
          learning_rate: 0.01
          bootstrap_type: Bayesian
          boost_from_average: false
          ctr_leaf_count_limit: 3
          leaf_estimation_iterations: 1
          leaf_estimation_method: Gradient
          model_catboost_path: models/model_catboost.joblib
          model_lgbm_path: models/model_lgbm.joblib
          X_test_path: data/processed/X_test_data.pkl
          Y_test_path: data/processed/Y_test_data.pkl
    outs:
    - path: reports/metrics_catboost.json
      md5: 3c908b995839e2b2ce77068a4f04bc10
      size: 113
    - path: reports/metrics_lightgbm.json
      md5: 129c428616bb290c3da93825add8110e
      size: 97
    - path: reports/metrics_rocauc_catboost.csv
      md5: 33a8c76cc22592c966126fe798fb58cf
      size: 119
    - path: reports/metrics_rocauc_lgbm.csv
      md5: c07dee1419e89a39544f117929426023
      size: 119
  inference:
    cmd: python -m src.inference.inference DATA_FILEPATH=data/raw/test.csv
    deps:
    - path: data/raw/test.csv
      md5: a34d239835317e59b1b9f2fec27fa427
      size: 249580
    - path: src/config.py
      md5: 3e4a7be725268dffcddc10290c19e4b1
      size: 2342
    - path: src/inference/inference.py
      md5: 5de4feda8eb23e2cec1052b592c46677
      size: 2287
    params:
      params.yaml:
        train:
          COL:
          - Пол
          - Семья
          - Этнос
          - Национальность
          - Религия
          - Профессия
          - Вы работаете?
          - Выход на пенсию
          - Прекращение работы по болезни
          - Сахарный диабет
          - Гепатит
          - Онкология
          - Хроническое заболевание легких
          - Бронжиальная астма
          - 'Туберкулез легких '
          - ВИЧ/СПИД
          - Регулярный прим лекарственных средств
          - Травмы за год
          - Переломы
          - Статус Курения
          - Пассивное курение
          - Частота пасс кур
          - Алкоголь
          - Сова/Жаворонок/Голубь
          - Часов сна
          - Сон после обеда
          - Спорт, клубы
          - Религия, клубы
          - Образование_ord
          - Возраст курения
          - Сигарет в день
          - Возраст алког
          CATEGORIES_COL_AFTER_PREP:
          - Пол
          - Семья
          - Этнос
          - Национальность
          - Религия
          - Профессия
          - Статус Курения
          - Частота пасс кур
          - Алкоголь
          - Сова/Жаворонок/Голубь
          test_size: 0.2
          iterations: 1000
          loss_function: MultiLogloss
          eval_metric: MultiLogloss
          learning_rate: 0.01
          bootstrap_type: Bayesian
          boost_from_average: false
          ctr_leaf_count_limit: 3
          leaf_estimation_iterations: 1
          leaf_estimation_method: Gradient
          model_catboost_path: models/model_catboost.joblib
          model_lgbm_path: models/model_lgbm.joblib
          X_test_path: data/processed/X_test_data.pkl
          Y_test_path: data/processed/Y_test_data.pkl
